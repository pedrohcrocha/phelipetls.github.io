<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>Extraindo dados de texto com RegEx no R · Phelipe</title> <meta name="description" content="Quando comecei a estudar R, via muito os vídeos do Roger Peng, quetem séries maravilhosas sobre muitos assuntos relacionados à linguagem.Um dos meus favorito..."> <link rel="icon" href="https://phelipetls.github.io/assets/favicon.png"> <link rel="apple-touch-icon" href="https://phelipetls.github.io/assets/touch-icon.png"> <link rel="stylesheet" href="https://phelipetls.github.io/assets/core.css"> <link rel="canonical" href="https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r"> <link rel="alternate" type="application/atom+xml" title="Phelipe" href="https://phelipetls.github.io/feed.xml" /> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} }); </script> <script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136684675-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-136684675-1'); </script> </head> <body> <aside class="logo"> <a href="https://phelipetls.github.io/"> <img src="https://avatars3.githubusercontent.com/u/39670535?s=460&amp;v=4" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <div id="content"> <article> <div class="center"> <h1 class="title">Extraindo dados de texto com RegEx no R</h1> <time class="code">April 1, 2019 | </time> <cats> <a href="/categories/#R">R</a> </cats> </div> <p></p>
<div class="center"><small>Tags: <cats> <a href="/tag/tidyverse">Tidyverse</a>, </cats> <cats> <a href="/tag/regex">Regex</a> </cats> </small></div> <div class="divider"></div> <p>Quando comecei a estudar R, via muito os vídeos do Roger Peng, que tem séries maravilhosas sobre muitos assuntos relacionados à linguagem. Um dos meus favoritos é um em que ele explora uma base de dados bastante bagunçada, de puro texto, em que ele usa <a href="https://youtu.be/q8SzNKib5-4">Regular Expressions</a> para extrair o máximo de informações dali.</p> <p>Neste post, pretendo explorar essa base mais a fundo, para depois, em um outro post, visualizar com o ggplot2 as informações coletadas.</p> <p>A base de dados é um pouco soturna: trata-se de registros de homicídios na cidade de Baltimore, em Maryland, com detalhes incluindo a raça da vítima, seu sexo, o local em que morreu, a causa da morte etc.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="n">homicides</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_lines</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/hadv/PAR/master/homicides.txt"</span><span class="p">)</span><span class="w">

</span><span class="n">homicides</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "39.311024, -76.674227, iconHomicideShooting, 'p2', '&lt;dl&gt;&lt;dt&gt;Leon Nelson&lt;/dt&gt;&lt;dd class=\"address\"&gt;3400 Clifton Ave.&lt;br /&gt;Baltimore, MD 21216&lt;/dd&gt;&lt;dd&gt;black male, 17 years old&lt;/dd&gt;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at Shock Trauma&lt;/dd&gt;&lt;dd&gt;Cause: shooting&lt;/dd&gt;&lt;/dl&gt;'"
## [2] "39.312641, -76.698948, iconHomicideShooting, 'p3', '&lt;dl&gt;&lt;dt&gt;Eddie Golf&lt;/dt&gt;&lt;dd class=\"address\"&gt;4900 Challedon Road&lt;br /&gt;Baltimore, MD 21207&lt;/dd&gt;&lt;dd&gt;black male, 26 years old&lt;/dd&gt;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at scene&lt;/dd&gt;&lt;dd&gt;Cause: shooting&lt;/dd&gt;&lt;/dl&gt;'"
## [3] "39.309781, -76.649882, iconHomicideBluntForce, 'p4', '&lt;dl&gt;&lt;dt&gt;Nelsene Burnette&lt;/dt&gt;&lt;dd class=\"address\"&gt;2000 West North Ave&lt;br /&gt;Baltimore, MD 21217&lt;/dd&gt;&lt;dd&gt;black female, 44 years old&lt;/dd&gt;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at scene&lt;/dd&gt;&lt;dd&gt;Cause: blunt force&lt;/dd&gt;&lt;/dl&gt;'"
</code></pre></div></div> <p>Como podemos ver, a base está de fato bastante suja. Quer dizer, é somente texto, nada está estruturado. O objetivo aqui é extrair o máximo de informações que pudermos. E perceba que elas são registradas de uma maneira padronizada. Por exemplo, a coordenada geográfica sempre vêm primeiro; a causa da morte vem depois de “Cause: ”; a raça, o sexo e a idade vêm todas numa tacada só, “black male, 17 years old”. Logo, como poderíamos tirar vantagem disso?</p> <h5 id="expressões-regulares-regex">Expressões regulares (RegEx)</h5> <p>O melhor modo de proceder é com Expressões Regulares, ou RegEx, que é, digamos, uma “linguagem” para encontrar padrões em strings, para daí extrair, substituir, remover etc.</p> <p>Como em toda linguagem, nela há uma série de caracteres especiais (metacharacters) com significados específicos, podendo expressar uma classe de caracteres, ou uma quantidade deles, ou uma condição lógica etc.</p> <p>Abaixo, uma lista sumária dos mais básicos. Tenha em mente que aqui não pretendo me prolongar tanto nisto. O resto irei introduzindo ao longo do texto.</p> <table> <thead> <tr> <th style="text-align: center">Qualitativos</th> <th style="text-align: left">Combina com:</th> </tr> </thead> <tbody> <tr> <td style="text-align: center"><code class="highlighter-rouge">\w</code></td> <td style="text-align: left">qualquer caractere alfanúmerico ou _</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">\d</code></td> <td style="text-align: left">qualquer número</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">\s</code></td> <td style="text-align: left">qualquer espaço</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">.</code></td> <td style="text-align: left">qualquer coisa</td> </tr> </tbody> </table> <table> <thead> <tr> <th style="text-align: center">Quantitativos</th> <th style="text-align: left">Significa que:</th> </tr> </thead> <tbody> <tr> <td style="text-align: center"><code class="highlighter-rouge">?</code></td> <td style="text-align: left">o caractere precedente é opcional</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">+</code></td> <td style="text-align: left">o caractere precedente é obrigatório</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">*</code></td> <td style="text-align: left">o caractere é opcional, podendo ocorrer nenhuma ou muitas vezes</td> </tr> <tr> <td style="text-align: center"><code class="highlighter-rouge">{m,n}</code></td> <td style="text-align: left">pode ocorrer no mínimo m, no máximo n vezes</td> </tr> </tbody> </table> <p>Vale mencionar ainda o significado dos colchetes e dos parênteses.</p> <p>Os parênteses servem para formar grupos dentro da regex, o que pode ter muitas utilidades, mas a que mais vamos explorar é a de extrair um determinado grupo da string.</p> <p>Já quando encapsulamos caracteres em colchetes, queremos que a string dê match com qualquer um que colocamos lá dentro. Eles formam um ambiente próprio, as regras mudam um pouco e até aceitam intervalos de caracteres! Por exemplo, <code class="highlighter-rouge">[a-e]</code> combina com “a”, “c” ou “e”, <code class="highlighter-rouge">[csa]+</code> combina com “casa”, e <code class="highlighter-rouge">\w</code> equivale a <code class="highlighter-rouge">[A-z0-9_]</code>.</p> <div class="divider"></div> <h4 id="extraindo-as-variáveis-com-stringr">Extraindo as variáveis com stringr</h4> <p>Para extrairmos os dados do texto, vamos usar o pacote stringr do tidyverse, mais especificamente a função <code class="highlighter-rouge">stringr::str_match</code>, que extrai de uma string o padrão e seus grupos.</p> <h6 id="causa-da-morte">Causa da morte</h6> <p>Ok, agora mão na massa, vamos começar pela causa da morte. As primeiras linhas indicam que ela é registrada deste modo: “Cause: <em>descrição</em>”, sendo a descrição uma string de letras (<code class="highlighter-rouge">\w</code>) e espaços (<code class="highlighter-rouge">\s</code>), logo, tente perceber que a regex apropriada é <code class="highlighter-rouge">Cause: [\\w\\s]+</code>: uma combinação de uma ou mais letras e espaços, precedida de “Cause: ”.</p> <p>E queremos, na verdade, somente essa combinação, esse prefixo não nos interessa. Por isso, colocamos eles entre parênteses, formando um grupo, que extraíremos da linha com a função <code class="highlighter-rouge">stringr::str_match</code>.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># note que, no r, precisamos infelizmente</span><span class="w">
</span><span class="c1"># adicionar uma \ a mais no regex</span><span class="w">
</span><span class="n">causes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cause: ([\\w\\s]+)"</span><span class="p">)</span><span class="w">

</span><span class="n">causes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                  [,2]
## [1,] "Cause: shooting"     "shooting"
## [2,] "Cause: shooting"     "shooting"
## [3,] "Cause: blunt force"  "blunt force"
## [4,] "Cause: asphyxiation" "asphyxiation"
## [5,] "Cause: blunt force"  "blunt force"
## [6,] "Cause: shooting"     "shooting"
</code></pre></div></div> <p>Veja que ele fez o esperado. A regex combinou com a parte da linha que imaginávamos e na segunda coluna temos extraída a informação que nos interessa. É esse o procedimento geral que vamos adotar aqui.</p> <h6 id="latitude-e-longitude">Latitude e Longitude</h6> <p>Outra informação importante é a coordenada geográfica. As strings que as representam são formadas por números <code class="highlighter-rouge">\d</code>, sinais de menos, <code class="highlighter-rouge">-</code> e pontos <code class="highlighter-rouge">.</code>. Para indicar que queremos um match no começo da linha, usaremos o metacharacter <code class="highlighter-rouge">^</code>. Observe que, dentro dos colchetes, o <code class="highlighter-rouge">.</code> não é um metacharacter, mas um ponto comum mesmo.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lat_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"^([\\d.-]+), ([\\d.-]+)"</span><span class="p">)</span><span class="w">

</span><span class="n">lat_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                    [,2]        [,3]
## [1,] "39.311024, -76.674227" "39.311024" "-76.674227"
## [2,] "39.312641, -76.698948" "39.312641" "-76.698948"
## [3,] "39.309781, -76.649882" "39.309781" "-76.649882"
## [4,] "39.363925, -76.598772" "39.363925" "-76.598772"
## [5,] "39.238928, -76.602718" "39.238928" "-76.602718"
## [6,] "39.352676, -76.607979" "39.352676" "-76.607979"
</code></pre></div></div> <h6 id="raça">Raça</h6> <p>Outra coisa em que estamos interessados é na raça da pessoa. Mas devo adiantar que essa não vai ser tão fácil. Isso porque o modo de registrar vai mudar mais para frente.</p> <p>No início o registro é do tipo “black male” etc., enquanto que, mais para o final, se registra assim, “Race: black”. Temos que lidar com isso. Podemos indicar que desejamos um match numa regex OU em outra com o metacharacter <code class="highlighter-rouge">|</code>. Daí que:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"&lt;dd&gt;(\\w+) (fe)?male|[Rr]ace: (\\w+)"</span><span class="p">)</span><span class="w">

</span><span class="n">raca</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]               [,2]    [,3] [,4]
## [1,] "&lt;dd&gt;black male"   "black" NA   NA
## [2,] "&lt;dd&gt;black male"   "black" NA   NA
## [3,] "&lt;dd&gt;black female" "black" "fe" NA
## [4,] "&lt;dd&gt;black male"   "black" NA   NA
## [5,] "&lt;dd&gt;white male"   "white" NA   NA
## [6,] "&lt;dd&gt;black male"   "black" NA   NA
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raca</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tail</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##         [,1]          [,2] [,3] [,4]
## [1245,] "Race: Black" NA   NA   "Black"
## [1246,] "Race: Black" NA   NA   "Black"
## [1247,] "Race: Black" NA   NA   "Black"
## [1248,] "Race: Black" NA   NA   "Black"
## [1249,] "Race: Black" NA   NA   "Black"
## [1250,] "Race: Black" NA   NA   "Black"
</code></pre></div></div> <p>Veja que, inseri um grupo a mais para indicar que é opcional todo o grupo “fe” em sexo, ele pode ou não ocorrer. Daí que o uso de grupos pode não ser somente para extrair.</p> <h6 id="gênero">Gênero</h6> <p>Esse caso é muito similar ao anterior, mudando de maneira idêntica no registro. Então vamos logo tratá-lo.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genero</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"&lt;dd&gt;\\w* (\\w+),?|[Gg]ender: (\\w+)"</span><span class="p">)</span><span class="w">

</span><span class="n">genero</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                [,2]     [,3]
## [1,] "&lt;dd&gt;black male,"   "male"   NA
## [2,] "&lt;dd&gt;black male,"   "male"   NA
## [3,] "&lt;dd&gt;black female," "female" NA
## [4,] "&lt;dd&gt;black male,"   "male"   NA
## [5,] "&lt;dd&gt;white male,"   "male"   NA
## [6,] "&lt;dd&gt;black male,"   "male"   NA
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genero</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tail</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##         [,1]             [,2] [,3]
## [1245,] "Gender: male"   NA   "male"
## [1246,] "Gender: male"   NA   "male"
## [1247,] "Gender: male"   NA   "male"
## [1248,] "Gender: female" NA   "female"
## [1249,] "Gender: male"   NA   "male"
## [1250,] "Gender: male"   NA   "male"
</code></pre></div></div> <h6 id="idade">Idade</h6> <p>E aqui a mesma coisa ocorre, vamos usar duas regex para dar conta disso:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idade</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"(\\d+) years? old|[Aa]ge: (\\d+)"</span><span class="p">)</span><span class="w">

</span><span class="n">idade</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]           [,2] [,3]
## [1,] "17 years old" "17" NA
## [2,] "26 years old" "26" NA
## [3,] "44 years old" "44" NA
## [4,] "21 years old" "21" NA
## [5,] "61 years old" "61" NA
## [6,] "46 years old" "46" NA
</code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idade</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tail</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##         [,1]      [,2] [,3]
## [1245,] "Age: 30" NA   "30"
## [1246,] "Age: 35" NA   "35"
## [1247,] "Age: 27" NA   "27"
## [1248,] "Age: 84" NA   "84"
## [1249,] "Age: 62" NA   "62"
## [1250,] "Age: 65" NA   "65"
</code></pre></div></div> <h6 id="data">Data</h6> <p>Outra informação bastante valiosa é a data do crime. Pelas primeiras linhas, vemos que ela normalmente vem depois de “Found on”, então provavelmente usaremos essa informação.</p> <p>Mas também temos que criar uma regex para data. A data é formada:</p> <ul> <li>pelo mês por extenso, <code class="highlighter-rouge">\w+</code>
</li> <li>seguido pelo dia, que pode ter no mínimo um e no máximo 2 dígitos</li> <li>seguido por uma vírgula</li> <li>e, por fim, o ano, um número de 4 dígitos</li> </ul> <p>Dito isto, a regex adequada é a do código. Alumas linhas tinham um espaço adicional entre o mês e o dia, por isso adicionei um “ ?” ali.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"[Ff]ound on (\\w+  ?\\d{1,2}, \\d{4})"</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                       [,2]
## [1,] "Found on January 1, 2007" "January 1, 2007"
## [2,] "Found on January 2, 2007" "January 2, 2007"
## [3,] "Found on January 2, 2007" "January 2, 2007"
## [4,] "Found on January 3, 2007" "January 3, 2007"
## [5,] "Found on January 5, 2007" "January 5, 2007"
## [6,] "Found on January 5, 2007" "January 5, 2007"
</code></pre></div></div> <h6 id="endereço">Endereço</h6> <p>Também pode ser interessante termos disponível o endereço de cada morte:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">endereco</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_match</span><span class="p">(</span><span class="n">homicides</span><span class="p">,</span><span class="w"> </span><span class="s2">"&gt;([A-z0-9 .]+)&lt;br ?/&gt;"</span><span class="p">)</span><span class="w">

</span><span class="n">endereco</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                          [,2]
## [1,] "&gt;3400 Clifton Ave.&lt;br /&gt;"    "3400 Clifton Ave."
## [2,] "&gt;4900 Challedon Road&lt;br /&gt;"  "4900 Challedon Road"
## [3,] "&gt;2000 West North Ave&lt;br /&gt;"  "2000 West North Ave"
## [4,] "&gt;5900 Northwood Drive&lt;br /&gt;" "5900 Northwood Drive"
## [5,] "&gt;500 Maude Ave.&lt;br /&gt;"       "500 Maude Ave."
## [6,] "&gt;5200 Ready Ave.&lt;br /&gt;"      "5200 Ready Ave."
</code></pre></div></div> <p>E presumo que seja isso. Se foi complicado, pode ser que esse não seja o post mais didático mesmo. Mas que fique claro que 90% do processo aqui envolveu ver onde estavam os <code class="highlighter-rouge">NA</code>, por quê, para daí ver onde poderia melhorar a regex etc. Importante considerar também que é muito mais fácil escrever regex do que as ler. Então tente você mesmo esse exercício.</p> <h6 id="agregando-tudo-em-um-dataframe">Agregando tudo em um data.frame</h6> <p>Agora precisamos juntar tudo num data.frame. Vamos pegar só as colunas dos grupos que nos interessam.</p> <p>Há casos em que há duas colunas para duas regex alternativas, e precisamos mesclá-las (substiruir os <code class="highlighter-rouge">NA</code> de uma com os valores da outra). Vou usar a função <code class="highlighter-rouge">ifelse</code> para isso.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">causas</span><span class="w">              </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">causes</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">lat</span><span class="w">                 </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">long_lat</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">lon</span><span class="w">                 </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">long_lat</span><span class="p">[,</span><span class="w"> </span><span class="m">3</span><span class="p">]</span><span class="w">
</span><span class="n">raca</span><span class="w">                </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">raca</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="n">raca</span><span class="p">[,</span><span class="w"> </span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">raca</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">genero</span><span class="w">              </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">genero</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="n">genero</span><span class="p">[,</span><span class="w"> </span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="n">genero</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">idade</span><span class="w">               </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">idade</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="n">idade</span><span class="p">[,</span><span class="w"> </span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="n">idade</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">data</span><span class="w">                </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">endereco</span><span class="w">            </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">endereco</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">

</span><span class="n">homicides_df</span><span class="w">        </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">causas</span><span class="p">,</span><span class="w">
                              </span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w">
                              </span><span class="n">raca</span><span class="p">,</span><span class="w"> </span><span class="n">genero</span><span class="p">,</span><span class="w"> </span><span class="n">idade</span><span class="p">,</span><span class="w">
                              </span><span class="n">data</span><span class="p">,</span><span class="w">
                              </span><span class="n">endereco</span><span class="p">)</span><span class="w">

</span><span class="n">homicides_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 6 x 8
##   causas     lon      lat      raca  genero idade data       endereco
##   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;
## 1 shooting   -76.674~ 39.3110~ black male   17    January 1~ 3400 Clifton ~
## 2 shooting   -76.698~ 39.3126~ black male   26    January 2~ 4900 Challedo~
## 3 blunt for~ -76.649~ 39.3097~ black female 44    January 2~ 2000 West Nor~
## 4 asphyxiat~ -76.598~ 39.3639~ black male   21    January 3~ 5900 Northwoo~
## 5 blunt for~ -76.602~ 39.2389~ white male   61    January 5~ 500 Maude Ave.
## 6 shooting   -76.607~ 39.3526~ black male   46    January 5~ 5200 Ready Av~
</code></pre></div></div> <p>E terminamos nossa limpeza dos dados. Na verdade, seria bom fazer algumas coisinhas antes, do tipo, uniformizar os valores das variáveis (alguns estão escritos em minúsculo enquanto outros não etc.), mudar o tipo das variáveis (a data precisa estar no formato Date) etc:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">homicides_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">homicides_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate_at</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">causas</span><span class="p">,</span><span class="w"> </span><span class="n">raca</span><span class="p">,</span><span class="w"> </span><span class="n">genero</span><span class="p">),</span><span class="w">
            </span><span class="nf">list</span><span class="p">(</span><span class="o">~</span><span class="n">str_to_title</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate_at</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="o">~</span><span class="n">as.numeric</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"%B %d, %Y"</span><span class="p">))</span><span class="w">

</span><span class="n">homicides_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w">
</span></code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 6 x 8
##   causas         lon   lat raca  genero idade data       endereco
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;
## 1 Shooting     -76.7  39.3 Black Male   17    2007-01-01 3400 Clifton Ave.
## 2 Shooting     -76.7  39.3 Black Male   26    2007-01-02 4900 Challedon Ro~
## 3 Blunt Force  -76.6  39.3 Black Female 44    2007-01-02 2000 West North A~
## 4 Asphyxiation -76.6  39.4 Black Male   21    2007-01-03 5900 Northwood Dr~
## 5 Blunt Force  -76.6  39.2 White Male   61    2007-01-05 500 Maude Ave.
## 6 Shooting     -76.6  39.4 Black Male   46    2007-01-05 5200 Ready Ave.
</code></pre></div></div> <p>E assim conseguimos uma base que pode render visualizações promissoras. Podemos olhar como a violência afeta pessoas de diferentes raças, idades e gêneros, ou até mesmo investigar a distribuição geográfica dos crimes!! E é exatamente isso o que eu pretendo fazer num post em breve. <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20"></p> </article> <div class="page-navigation code"> <a class="home" href="https://phelipetls.github.io/" title="Back to Index">Index</a> <span> · </span> <a class="prev" href="https://phelipetls.github.io/spread-bancario-brasileiro-r" title="PREV: Spread bancário brasileiro: limpeza e visualização de dados">&gt;&gt;</a> </div> <div class="center"> <b></b> <style> #share-buttons {display: inline-block; vertical-align: middle; } #share-buttons:after {content: ""; display: block; clear: both;} #share-buttons > div { position: relative; text-align: left; height: 36px; width: 32px; float: left; text-align: center; } #share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;} #share-buttons > div:hover {cursor: pointer;} #share-buttons > div.facebook:hover > svg {fill: #3B5998;} #share-buttons > div.twitter:hover > svg {fill: #55ACEE;} #share-buttons > div.linkedin:hover > svg {fill: #0077b5;} #share-buttons > div.pinterest:hover > svg {fill: #CB2027;} #share-buttons > div.gplus:hover > svg {fill: #dd4b39;} #share-buttons > div.mail:hover > svg {fill: #7D7D7D;} #share-buttons > div.instagram:hover > svg {fill: #C73B92;} #share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;} #share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;} #share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;} #share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;} #share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;} #share-buttons > div.mail > svg {height: 14px; margin-top: 11px;} </style> <span style="color: silver;"><br>Compartilhe: </span><div id="share-buttons"> <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r');"><svg viewbox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"></path></svg></div> <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r');"><svg viewbox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg></div> <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&amp;url=https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r&amp;title=&amp;summary=&amp;source=');"><svg viewbox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"></path></svg></div> <div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r');"><svg viewbox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"></path></svg></div> <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&amp;body=https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r');"><svg viewbox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"></path></svg></div> </div> </div> <div class="disqus_layout"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://phelipetls.github.io/homicidios-em-baltimore-minerando-dados-r'; this.page.identifier = '/homicidios-em-baltimore-minerando-dados-r'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//phelipetls-github-io.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript> </div> </div> <div class="footer"> <a href="https://github.com/phelipetls"><i class="fa fa-github"></i></a> <a style="padding-left:10px;" href="https://linkedin.com/in/phelipeteles"><i class="fa fa-linkedin"></i></a> <a style="padding-left:10px;" href="mailto:phelipe_teles@hotmail.com"><i class="fa fa-envelope"></i></a> <p> <span class="block">© 2019 Phelipe Teles</span> <span class="block"><small>&lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/the-plain">The Plain theme</a>.</small></span> </p> </div> </body> </html>
